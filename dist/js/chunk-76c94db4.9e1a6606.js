(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76c94db4"],{"0a9b":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("b-card",{staticClass:"overflow-hidden"},[s("h5",{staticClass:"mb-4"},[s("i",{staticClass:"fa fa-truck-loading",attrs:{color:"#7367f0"}}),t._v(" ออเดอร์ ")]),s("div",{staticClass:"mb-3 mx-2"},[s("b-row",[s("b-col",{staticClass:"d-flex align-items-center justify-content-start mb-1",attrs:{cols:"12",lg:"3",md:"6"}},[s("label",[t._v("แสดง")]),s("b-select",{staticClass:"\n              per-page-selector\n              d-inline-block\n              mx-50\n              select-per-page\n              ml-2\n              mr-2\n            ",attrs:{options:t.perPageOptions,clearable:!1},on:{change:t.changeItemPerPage},model:{value:t.itemPerPage,callback:function(e){t.itemPerPage=e},expression:"itemPerPage"}}),s("label",[t._v("รายการ")])],1),s("b-col",{staticClass:"d-none d-md-inline",attrs:{cols:"12",lg:"4",md:"6"}},[s("div",{staticClass:"d-flex align-items-center justify-content-end mb-1"},[s("label",[t._v("สถานะ")]),s("b-select",{staticClass:"per-page-selector d-inline-block mx-50 ml-2 mr-2",attrs:{options:t.filterStatus,clearable:!1},on:{change:t.changeStatus},model:{value:t.statusFilter,callback:function(e){t.statusFilter=e},expression:"statusFilter"}})],1)]),s("b-col",{staticClass:"d-none d-md-inline",attrs:{cols:"12",lg:"5",md:"6"}},[s("div",{staticClass:"d-flex align-items-center justify-content-end"},[s("b-form",{on:{submit:function(e){return e.preventDefault(),t.searchOrderID(e)}}},[s("b-input-group",{staticClass:"input-group-merge pr-2"},[s("b-form-input",{staticClass:"d-inline-block",attrs:{placeholder:"ค้นหาออเดอร์",autocomplete:"off"},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),s("b-input-group-append",{staticClass:"pointer",attrs:{"is-text":""},on:{click:t.searchOrderID}},[s("i",{staticClass:"fas fa-search"})])],1)],1)],1)]),s("b-col",{staticClass:"d-md-none",attrs:{cols:"12",lg:"6",md:"6"}},[s("div",{staticClass:"mb-3 text-right custom-filters"},[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:"collapse-filter",expression:"'collapse-filter'"}],staticClass:"collapse-icon",attrs:{size:"sm",variant:"outline-info"}},[t._v("ฟิลเตอร์ "),s("div",{staticClass:"col-1 icon-coll d-inline"},[s("i",{staticClass:"fa fa-chevron-up icon-coll-open-filter"})])])],1),s("b-collapse",{attrs:{id:"collapse-filter"}},[s("div",{staticClass:"d-flex align-items-center justify-content-end mb-1"},[s("label",[t._v("สถานะ")]),s("b-select",{staticClass:"per-page-selector d-inline-block mx-50 ml-2 mr-2",attrs:{options:t.filterStatus,clearable:!1},on:{change:t.changeStatus},model:{value:t.statusFilter,callback:function(e){t.statusFilter=e},expression:"statusFilter"}})],1),s("div",{staticClass:"d-flex align-items-center justify-content-end"},[s("b-form",{on:{submit:function(e){return e.preventDefault(),t.searchOrderID(e)}}},[s("b-input-group",{staticClass:"input-group-merge pr-2"},[s("b-form-input",{staticClass:"d-inline-block",attrs:{placeholder:"ค้นหาออเดอร์",autocomplete:"off"},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),s("b-input-group-append",{staticClass:"pointer",attrs:{"is-text":""},on:{click:t.searchOrderID}},[s("i",{staticClass:"fas fa-search"})])],1)],1)],1)])],1)],1)],1),t.loading?s("div",{staticClass:"p-5"},[s("vcl-table")],1):t._e(),t.loading?t._e():s("div",[s("b-card-body",[0!=this.orders.length?s("div",{staticClass:"text-mute mb-2"},[t._v(" ออเดอร์ที่ "+t._s(t.itemStart)+" - "+t._s(t.itemEnd)+" จาก "+t._s(t.totalDatas)+" ")]):t._e(),s("b-table",{attrs:{items:t.orders,fields:t.fields,hover:!0,responsive:"","show-empty":"","empty-text":"ไม่พบข้อมูล","empty-filtered-text":"ไม่พบข้อมูล","tbody-tr-class":"tableHover"},scopedSlots:t._u([{key:"cell(status)",fn:function(e){return[s("div",["รอชำระ"==e.item.status?s("div",[s("b-badge",{staticClass:"status-wait-style",attrs:{pill:""}},[s("i",{staticClass:"fa fa-clock"}),t._v(" "+t._s(e.item.status))])],1):t._e(),"รอการตรวจสอบ"==e.item.status?s("div",[s("b-badge",{staticClass:"status-checkSlip-style",attrs:{pill:""}},[s("i",{staticClass:"fa fa-search-dollar"}),t._v(" "+t._s(e.item.status))])],1):t._e(),"เตรียมจัดส่ง"==e.item.status?s("div",[s("b-badge",{staticClass:"status-ready-style",attrs:{pill:""}},[s("i",{staticClass:"fa fa-truck-loading"}),t._v(" "+t._s(e.item.status))])],1):t._e(),"อยู่ระหว่างการจัดส่ง"==e.item.status?s("div",[s("b-badge",{staticClass:"status-sent-style",attrs:{pill:""}},[s("i",{staticClass:"fa fa-shipping-fast"}),t._v(" "+t._s(e.item.status))])],1):t._e(),"จัดส่งแล้ว"==e.item.status?s("div",[s("b-badge",{staticClass:"status-check-style",attrs:{pill:""}},[s("i",{staticClass:"fa fa-check"}),t._v(" "+t._s(e.item.status))])],1):t._e(),"ยกเลิก"==e.item.status?s("div",[s("b-badge",{staticClass:"status-cancle-style",attrs:{pill:""}},[s("i",{staticClass:"fa fa-times"}),t._v(" "+t._s(e.item.status))])],1):t._e()])]}},{key:"cell(orderID)",fn:function(e){return[s("div",{staticClass:"orderId-width"},[s("span",{staticClass:"color-primary pointer",on:{click:function(s){return t.getDetail(e.item)}}},[s("FileTextIcon",{staticClass:"mb-1 mr-1",attrs:{size:"18"}}),t._v(t._s(e.item.orderID))],1)])]}},{key:"cell(listItem)",fn:function(e){return[s("div",{staticClass:"width-list"},[t._v(t._s(e.item.listItem)+" รายการ")])]}},{key:"cell(totalPrice)",fn:function(e){return[s("div",{staticClass:"price-width"},[t._v(" "+t._s(t.formatPrice(e.item.totalPrice))+" บาท ")])]}},{key:"cell(createAt)",fn:function(e){return[s("div",{staticClass:"time-width",class:t.checkTimeOut(e.item)?"over-time":""},[t._v(" "+t._s(t.formatDate(e.item.createAt))+" ")])]}},{key:"cell(updateAt)",fn:function(e){return[s("div",{staticClass:"time-width",class:t.checkTimeOut(e.item)?"over-time":""},[t._v(" "+t._s(t.formatDate(e.item.updateAt))+" ")])]}},{key:"cell(actions)",fn:function(e){return[s("b-dropdown",{staticClass:"dropdown-right",attrs:{size:"md",variant:"link",right:"","no-caret":""},scopedSlots:t._u([{key:"button-content",fn:function(){return[s("i",{staticClass:"fa fa-ellipsis-v",attrs:{color:"#7367f0"}})]},proxy:!0}],null,!0)},[s("b-dropdown-item",{on:{click:function(s){return t.getDetail(e.item)}}},[s("i",{staticClass:"fa fa-search"}),t._v(" รายละเอียด")]),s("b-dropdown-item",{on:{click:function(s){return t.toggleModal("edit",e.item)}}},[s("i",{staticClass:"fa fa-edit"}),t._v(" แก้ไข")])],1)]}}],null,!1,2482349306)})],1),0!=this.orders.length?s("div",{staticClass:"mx-2"},[s("b-row",[s("b-col",{staticClass:"\n              d-flex\n              align-items-center\n              justify-content-center justify-content-sm-start\n            ",attrs:{cols:"12",sm:"6"}},[s("span",{staticClass:"text-mute total-data"},[t._v("ออเดอร์ที่ "+t._s(t.itemStart)+" - "+t._s(t.itemEnd)+" จาก "+t._s(t.totalDatas))])]),s("b-col",{staticClass:"\n              d-flex\n              align-items-center\n              justify-content-center justify-content-sm-end\n            ",attrs:{cols:"12",sm:"6"}},[s("Pagination",{attrs:{currentPage:this.$store.state.currentP+1,totalItem:t.totalDatas,itemPerPage:t.itemPerPage,start:t.itemStart,end:t.itemEnd},on:{selectedPage:t.loadMore}})],1)],1)],1):t._e()],1)]),s("b-modal",{staticClass:"modalClass product-modal",attrs:{id:"modal-1",title:"edit"==t.formMode?"แก้ไขออเดอร์ "+t.itemSelected.orderID:"","hide-footer":"",size:"md"}},[[s("b-form",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[s("b-row",[s("b-col",{attrs:{md:"6"}},[s("b-form-group",{staticClass:"mb-2",attrs:{label:"สถานะสินค้า","label-for":"product-status"}},[s("b-form-select",{attrs:{id:"product-status",options:t.optionStatus},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1)],1),s("b-col",{attrs:{md:"12"}},[s("b-form-group",{staticClass:"mb-2",attrs:{label:"หมายเลขพัสดุ ("+this.itemSelected.deliverCompany+")","label-for":"deliverNumber"}},[s("b-form-input",{attrs:{id:"deliverNumber",autocomplete:"off",placeholder:"กรอกหมายเลขพัสดุ"},model:{value:t.form.deliverNumber,callback:function(e){t.$set(t.form,"deliverNumber",e)},expression:"form.deliverNumber"}})],1)],1),s("b-col",{staticClass:"mt-2",attrs:{cols:"12"}},[s("b-button",{staticClass:"mr-1",attrs:{variant:"primary",type:"submit"}},[t._v(" บันทึก ")]),s("b-button",{attrs:{variant:"outline-primary"},on:{click:t.closeModal}},[t._v(" ยกเลิก ")])],1)],1)],1)]],2)],1)},r=[],i=s("28f7"),l=s("68ee"),o=s("c1df"),c=s.n(o),n=s("6407"),d=s("0a35"),u=(s("78a7"),{name:"orders",components:{VclTable:l["VclTable"],Pagination:n["a"],FileTextIcon:d["g"]},data(){return{orders:[],loading:!1,itemSelected:{},formMode:"",form:{},perPageOptions:["25","50","75"],totalDatas:null,itemPerPage:25,itemStart:null,itemEnd:null,searchQuery:"",optionStatus:["รอชำระ","รอการตรวจสอบ","เตรียมจัดส่ง","อยู่ระหว่างการจัดส่ง","จัดส่งแล้ว","ยกเลิก"],filterStatus:["ทั้งหมด","รอชำระ","รอการตรวจสอบ","เตรียมจัดส่ง","อยู่ระหว่างการจัดส่ง","จัดส่งแล้ว","ยกเลิก"],statusFilter:"ทั้งหมด",fields:[{key:"orderID",sortable:!0},{key:"status",sortable:!0},{key:"listItem",sortable:!0},{key:"totalPrice",sortable:!0},{key:"createAt",sortable:!0},{key:"updateAt",sortable:!0},{key:"actions"}]}},created(){this.loadOrder()},methods:{loadOrder(){this.loading=!0;let t=this.itemPerPage*this.$store.state.currentP;const e=i["a"].firestore().collection("orders");var s;return s="ทั้งหมด"!=this.statusFilter?""!=this.searchQuery?e.where("status","==",this.statusFilter).where("orderID",">=",this.searchQuery).where("orderID","<=",this.searchQuery+""):e.where("status","==",this.statusFilter).orderBy("createAt","desc"):""!=this.searchQuery?e.where("orderID",">=",this.searchQuery).where("orderID","<=",this.searchQuery+""):e.orderBy("createAt","desc"),s.get().then(e=>{let a=e.docs[t];var r=e.docs.length,i=this.$store.state.currentP+1,l=i*this.itemPerPage-(this.itemPerPage-1),o=Math.min(l+this.itemPerPage-1,r);if(this.itemStart=l,this.itemEnd=o,this.totalDatas=r,a)var c=s.startAt(a).limit(this.itemPerPage);else c=s.limit(this.itemPerPage);c.get().then(t=>{var e=[];t.forEach(t=>{var s={orderID:t.data().orderID,uid:t.id,status:t.data().status,deliverNumber:t.data().deliverNumber,deliverCompany:"ฟรี"!=t.data().deliverCompany?t.data().deliverCompany:"kerry",listItem:t.data().items.length,totalPrice:t.data().totalAll,userID:t.data().userID,items:t.data().items,createAt:t.data().createAt,updateAt:t.data().updateAt};e.push(s)}),this.loading=!1,this.orders=e}).catch(t=>{this.loading=!1,console.log(t)})}).catch(t=>{this.loading=!1,console.log(t)})},getDetail(t){this.$router.push("/admin/order/"+t.uid)},changeStatus(t){this.statusFilter=t,this.loadOrder()},changeItemPerPage(t){this.itemPerPage=t,this.loadOrder()},loadMore(t){this.$store.dispatch("changePage",t),this.loadOrder()},toggleModal(t,e){this.formMode=t,this.itemSelected=e,"edit"==t&&(this.form={id:e.uid,status:e.status,deliverNumber:e.deliverNumber},this.$bvModal.show("modal-1"))},closeModal(){this.$bvModal.hide("modal-1")},submit(){this.$bvModal.hide("modal-1"),this.loading=!0;var t={status:this.form.status,deliverNumber:this.form.deliverNumber},e="";this.itemSelected.status!=this.form.status?(e="สถานะ",t.updateAt=new Date,"เตรียมจัดส่ง"==this.form.status?this.checkRemoveStock(this.itemSelected.orderID):"จัดส่งแล้ว"==this.form.status&&this.checkIncome(this.itemSelected)):e="ข้อมูล";const s=i["a"].firestore().doc("orders/"+this.form.id);return s.update(t).then(()=>{this.loading=!1,this.$toast.success("แก้ไข"+e+"เรียบร้อย",{position:"top-right",closeOnClick:!0,hideProgressBar:!0,timeout:3e3,icon:"fa fa-check-circle"}),this.loadOrder()}).catch(t=>{this.loading=!1,this.$toast.error("แก้ไข"+e+"ไม่สำเร็จ",{position:"top-right",closeOnClick:!0,hideProgressBar:!0,timeout:3e3,icon:"fa fa-exclamation-triangle"}),console.log(t)})},checkRemoveStock(t){var e=i["a"].firestore().collection("logRemoveStock");return e.where("orderID","==",t).get().then(s=>{if(0==s.size){var a=[];this.itemSelected.items.map(t=>{var e={productIDRef:t.id,quantity:t.quantity};a.push(e)});var r={itemRemove:a,orderID:t,createAt:new Date};e.add(r),this.removeItemStock()}})},checkIncome(t){i["a"].firestore().doc("users/"+t.userID).get().then(e=>{const s=i["a"].firestore().collection("incomes");return s.where("orderID","==",t.orderID).get().then(a=>{var r=a.size;if(0==r){var i={createAt:new Date,description:"ได้รับเงินจากการซื้อสินค้า",orderID:t.orderID,status:"cash-in",price:t.totalPrice,userProfile:{image:e.data().image,email:e.data().email,name:e.data().name,role:e.data().role,userID:e.id}};s.add(i)}})})},formatDate(t){var e=t.toDate(),s=c()(e).format("DD-MM-YYYY HH:mm");return s},formatPrice(t){let e=(t/1).toFixed(0);return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},searchOrderID(){this.loadOrder()},removeItemStock(){this.itemSelected.items.map(async t=>{var e=t.id,s=t.quantity;await this.updateProductStock(e,s)})},updateProductStock(t,e){const s=i["a"].firestore().doc("products/"+t);return s.get().then(t=>{var a=t.data().stock,r=t.data().sold,i=a-e,l=r+e,o={stock:i,sold:l};return s.update(o).then(()=>{})})},checkTimeOut(t){if("รอชำระ"==t.status){var e=t.createAt.toDate(),s=c()(e).format("YYYY-MM-DD 00:00"),a=new Date(s),r=c()().subtract(4,"day").format("YYYY-MM-DD 00:00"),i=new Date(r);if(a<i)return!0}}}}),m=u,h=(s("777a"),s("2877")),f=Object(h["a"])(m,a,r,!1,null,null,null);e["default"]=f.exports},"30b0":function(t,e,s){"use strict";s("5a74")},"5a74":function(t,e,s){},6407:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"overflow-auto"},[s("div",{staticClass:"pagination-item"},[s("b-pagination",{attrs:{"total-rows":t.rows,"per-page":t.perPage,"aria-controls":"my-table"},on:{input:function(e){return t.updatePage(t.currentPage)}},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)])},r=[],i={name:"Pagination",props:["currentPage","totalItem","itemPerPage","start","end"],data(){return{perPage:this.itemPerPage}},methods:{updatePage(t){this.$emit("selectedPage",t-1)}},computed:{rows(){return this.totalItem}}},l=i,o=(s("30b0"),s("2877")),c=Object(o["a"])(l,a,r,!1,null,"62654af7",null);e["a"]=c.exports},"777a":function(t,e,s){"use strict";s("c79e")},c79e:function(t,e,s){}}]);
//# sourceMappingURL=chunk-76c94db4.9e1a6606.js.map