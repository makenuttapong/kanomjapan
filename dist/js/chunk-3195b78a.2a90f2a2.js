(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3195b78a"],{3573:function(t,a,e){t.exports=e.p+"img/profits.63458998.png"},5651:function(t,a,e){t.exports=e.p+"img/userDF.d961d73a.png"},"58e0":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",[s("b-row",{staticClass:"match-height"},[s("b-col",{attrs:{lg:"8"}},[s("b-row",[s("b-col",{attrs:{lg:"12"}},[s("b-card",{staticClass:"md-mb-4"},[s("div",{staticClass:"d-flex space-between mb-2"},[s("h5",[s("i",{staticClass:"fas fa-wallet",attrs:{color:"#7367f0"}}),t._v(" รายได้")]),s("div",[s("b-dropdown",{directives:[{name:"ripple",rawName:"v-ripple.400",value:"rgba(113, 102, 240, 0.15)",expression:"'rgba(113, 102, 240, 0.15)'",modifiers:{400:!0}}],staticClass:"margin20",attrs:{text:t.sortBy.text,right:"",variant:"outline-primary"}},t._l(t.sortByOptions,(function(a){return s("b-dropdown-item",{key:a.value,on:{click:function(e){return t.changeType(a)}}},[t._v(" "+t._s(a.text)+" ")])})),1),s("div",{staticClass:"mx-50 select-month ml-2 mr-2 d-inline-block"},["รายเดือน"==t.sortBy.text?s("date-picker",{attrs:{valueType:"format",type:"month",format:"YYYY-MM"},on:{change:t.selectMonth},model:{value:t.monthSelect,callback:function(a){t.monthSelect=a},expression:"monthSelect"}}):t._e(),"รายปี"==t.sortBy.text?s("date-picker",{attrs:{valueType:"format",type:"year",format:"YYYY"},on:{change:t.selectYear},model:{value:t.yearSelect,callback:function(a){t.yearSelect=a},expression:"yearSelect"}}):t._e()],1)],1)]),s("b-row",{staticClass:"match-height"},[s("b-col",{attrs:{lg:"4",md:"4",sm:"4"}},[s("div",{staticClass:"card card-show in"},[s("b-row",[s("b-col",{attrs:{lg:"4"}},[s("div",{staticClass:"circle-white mb-1"},[s("img",{attrs:{src:e("ce95"),width:"30px"}})])]),s("b-col",{staticClass:"all-center-price",attrs:{lg:"8"}},[s("div",{staticClass:"text-right font17"},[t._v("รายรับ")])])],1),s("div",{staticClass:"text-right text-priceIncom mt-2"},[t._v(" "+t._s(t.formatPrice(t.allCashIn))+" THB ")])],1)]),s("b-col",{attrs:{lg:"4",md:"4",sm:"4"}},[s("div",{staticClass:"card card-show out"},[s("b-row",[s("b-col",{attrs:{lg:"4"}},[s("div",{staticClass:"circle-white mb-1"},[s("img",{attrs:{src:e("aa5e"),width:"30px"}})])]),s("b-col",{staticClass:"all-center-price",attrs:{lg:"8"}},[s("div",{staticClass:"text-right font17"},[t._v("รายจ่าย")])])],1),s("div",{staticClass:"text-right text-priceIncom mt-2"},[t._v(" "+t._s(t.formatPrice(t.allCashOut))+" THB ")])],1)]),s("b-col",{attrs:{lg:"4",md:"4",sm:"4"}},[s("div",{staticClass:"card card-show diff"},[s("b-row",[s("b-col",{attrs:{lg:"4"}},[s("div",{staticClass:"circle-white mb-1"},[s("img",{attrs:{src:e("3573"),width:"30px"}})])]),s("b-col",{staticClass:"all-center-price",attrs:{lg:"8"}},[s("div",{staticClass:"text-right font17"},[t._v("กำไร")])])],1),s("div",{staticClass:"text-right text-priceIncom mt-2"},[t._v(" "+t._s(t.formatPrice(t.profit))+" THB ")])],1)])],1),s("div",{staticClass:"mt-1"},[s("div",{staticClass:"d-flex space-between"},[s("h6",[s("CalendarIcon",{staticClass:"mr-1 mb-1",attrs:{size:"18"}}),t._v("รายได้"+t._s("month"==t.mode?"เดือน":"ปี")+"นี้ ")],1),s("div")]),t.loadingAll?s("div",{staticClass:"p-4 row"},[s("vcl-twitch",{attrs:{width:"600px"}})],1):t._e(),t.loadingAll?t._e():s("div",[0!=this.lineChartSimple.series[0].data?s("vue-apex-charts",{attrs:{type:"line",height:"320",options:t.lineChartSimple.chartOptions,series:t.lineChartSimple.series}}):t._e()],1)])],1)],1)],1)],1),s("b-col",{attrs:{lg:"4"}},[s("b-card",[s("div",{staticClass:"d-flex space-between mb-3"},[s("span",{staticClass:"mt-1"},[t._v("รายการล่าสุด")]),s("b-button",{attrs:{variant:"outline-primary",size:"sm"},on:{click:t.moreIncome}},[t._v("เพิ่มเติม")])],1),t.loading?s("div",{staticClass:"p-2"},[s("vcl-facebook")],1):t._e(),t.loading?t._e():s("div",[0==t.incomes.length?s("div",{staticClass:"text-center p-4 text-mute"},[t._v(" ไม่พบรายการ ")]):t._e(),t._l(t.incomes,(function(a,i){return s("div",{key:i,staticClass:"mb-3"},[s("div",{class:"cash-in"==a.status?"cashIn":"cashOut"},[s("b-row",[s("b-col",{attrs:{lg:"8",md:"8",cols:"8"}},[s("b-row",[s("b-col",{attrs:{lg:"12"}},[s("b-avatar",{staticClass:"avatar-income",attrs:{src:a.userProfile.image?a.userProfile.image:e("5651")}}),s("span",{staticClass:"ml-1 text-small oneline"},[t._v(t._s("admin"!=a.userProfile.role?a.userProfile.name:"ADMIN"))])],1),s("b-col",{attrs:{lg:"12"}},[s("div",{staticClass:"text-small mt-2 mb-1"},[s("span",{staticClass:"bold"},[t._v("orderID : ")]),t._v(t._s(a.orderID)+" ")])]),s("b-col",{attrs:{lg:"12"}},[s("div",{staticClass:"text-mute date-income"},[s("CalendarIcon",{staticClass:"mb-1 mr-1",attrs:{size:"13"}}),t._v(t._s(t.formatDate(a.createAt))+" ")],1)])],1)],1),s("b-col",{staticClass:"all-center-price",attrs:{lg:"4",md:"4",cols:"4"}},[s("div",{staticClass:"price-cash"},[s("span",{class:"cash-in"==a.status?"cashIn-price":"cashOut-price"},[t._v(t._s("cash-out"==a.status?"-":"+")+t._s(t.formatPrice(a.price)))])])])],1)],1)])}))],2)])],1)],1)],1)},i=[],r=e("28f7"),l=(e("78a7"),e("68ee")),o=e("c1df"),c=e.n(o),n=e("0a35"),h=e("e009"),d=e("1321"),m=e.n(d),p={name:"IncomePage",directives:{Ripple:h["a"]},components:{VclFacebook:l["VclFacebook"],VclTwitch:l["VclTwitch"],CalendarIcon:n["c"],VueApexCharts:m.a},data(){return{loading:!1,loadingAll:!1,incomes:[],itemcount:0,monthSelect:"",mode:"month",yearSelect:"",allCashIn:0,allCashOut:0,profit:0,sortBy:{text:"รายเดือน",value:"รายเดือน"},sortByOptions:[{text:"รายเดือน",value:"รายเดือน"},{text:"รายปี",value:"รายปี"}],lineChartSimple:{series:[{data:[]}],chartOptions:{chart:{zoom:{enabled:!1},toolbar:{show:!1}},markers:{strokeWidth:7,strokeOpacity:1,strokeColors:["#f8f8f8"],colors:["#576dff"]},colors:["#576dff"],dataLabels:{enabled:!1},stroke:{curve:"straight"},grid:{xaxis:{lines:{show:!0}}},tooltip:{custom(t){return`<div class="px-1 py-50"><span>${t.series[t.seriesIndex][t.dataPointIndex]} บาท</span></div>`}},xaxis:{categories:[]},yaxis:{}}}}},created(){this.monthSelect=c()().startOf("months").format("YYYY-MM"),this.nextMonthSelect=c()(this.monthSelect).add(1,"month").format("YYYY-MM"),this.loadAllIn(this.monthSelect),this.loadIncome()},methods:{selectMonth(t){this.monthSelect=t,this.loadAllIn(t)},loadAllIn(t){this.loadingAll=!0,this.mode="month";var a=r["a"].firestore().collection("incomes"),e=c()().format(t+"-01 00:00"),s=c()(t).add(1,"month").format("YYYY-MM-DD 00:00"),i=[];while(e<=s)i.push(e),e=c()(e).add(1,"day").format("YYYY-MM-DD 00:00");var l=new Date(i[0]),o=new Date(i[i.length-1]);a.where("createAt",">=",l).where("createAt","<",o).get().then(a=>{this.itemcount=a.size;var e=c()(t).endOf("month").format("DD"),s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];"30"==e?s.pop():"29"==e?(s.pop(),s.pop()):"28"==e&&(s.pop(),s.pop(),s.pop());var r=0,l=0;a.forEach(t=>{"cash-in"==t.data().status?(r+=t.data().price,i.forEach((a,e)=>{this.checkDateYMD(t.data().createAt)==a&&(s[e]=s[e]+t.data().price)})):"cash-out"==t.data().status&&(l+=t.data().price)}),this.allCashIn=r,this.allCashOut=l,this.profit=r-l,this.lineChartSimple.series[0].data=s,this.lineChartSimple.chartOptions.xaxis.categories=[],this.loadingAll=!1})},checkDateYMD(t){var a=t.toDate(),e=c()(a).format("YYYY-MM-DD 00:00");return e},loadIncome(){this.loading=!0;const t=r["a"].firestore().collection("incomes").orderBy("createAt","desc");return t.limit(4).get().then(t=>{var a=[];t.forEach(t=>{var e={uid:t.id,createAt:t.data().createAt,description:t.data().description,orderID:t.data().orderID,price:t.data().price,status:t.data().status,userProfile:t.data().userProfile};a.push(e)}),this.incomes=a,this.loading=!1}).catch(t=>{this.loading=!1,console.error(t)})},formatDate(t){var a=t.toDate(),e=c()(a).format("DD-MM-YYYY HH:mm");return e},formatPrice(t){let a=(t/1).toFixed(0);return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},moreIncome(){this.$router.push("income-list")},changeType(t){this.sortBy=t,"รายเดือน"==t.value?(this.monthSelect=c()().startOf("months").format("YYYY-MM"),this.loadAllIn(this.monthSelect)):(this.yearSelect=c()().startOf("months").format("YYYY"),this.loadAllYear(this.yearSelect))},selectYear(t){this.yearSelect=t,this.loadAllYear(t)},loadAllYear(t){console.log(t),this.loadingAll=!0,this.mode="year";var a=r["a"].firestore().collection("incomes"),e=c()().format(t+"-01 00:00"),s=c()(t).add(1,"year").format("YYYY-MM 00:00"),i=[];while(e<=s)i.push(e),e=c()(e).add(1,"month").format("YYYY-MM 00:00");var l=new Date(i[0]),o=new Date(i[i.length-1]);a.where("createAt",">=",l).where("createAt","<",o).get().then(t=>{this.itemcount=t.size;var a=[0,0,0,0,0,0,0,0,0,0,0,0],e=0,s=0;t.forEach(t=>{"cash-in"==t.data().status?(e+=t.data().price,i.forEach((e,s)=>{this.checkDateYM(t.data().createAt)==e&&(a[s]=a[s]+t.data().price)})):"cash-out"==t.data().status&&(s+=t.data().price)}),this.allCashIn=e,this.allCashOut=s,this.profit=e-s,this.lineChartSimple.series[0].data=a,this.lineChartSimple.chartOptions.xaxis.categories=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],this.loadingAll=!1})},checkDateYM(t){var a=t.toDate(),e=c()(a).format("YYYY-MM 00:00");return e}}},u=p,f=(e("5ae7"),e("2877")),v=Object(f["a"])(u,s,i,!1,null,null,null);a["default"]=v.exports},"5ae7":function(t,a,e){"use strict";e("6bd8")},"6bd8":function(t,a,e){},aa5e:function(t,a,e){t.exports=e.p+"img/pay.0a0f196f.png"},ce95:function(t,a,e){t.exports=e.p+"img/salary.d342f34b.png"}}]);
//# sourceMappingURL=chunk-3195b78a.2a90f2a2.js.map